<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Talent Tag AI ‚Äì Your Career, Reimagined</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <!-- QR Code Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
  <!-- Auth0 SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@auth0/auth0-spa-js@2.0/dist/auth0-spa-js.production.js"></script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

  <style>
    /* --- CORE STYLES --- */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f5f5f7;
      color: #1d1d1f;
    }
    html.dark body {
      background-color: #111827;
      color: #f5f5f7;
    }

    /* --- DYNAMIC ISLAND & FLOATING MENUS --- */
    .floating-island {
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
      border: 1px solid rgba(0,0,0,0.08);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    html.dark .floating-island {
      background: rgba(29,29,31,0.75);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .floating-island nav {
      max-width: 0; opacity: 0; overflow: hidden; white-space: nowrap;
      transition: max-width 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s ease;
    }
    .floating-island.expanded nav {
      max-width: 500px; opacity: 1;
      transition: max-width 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease 0.1s;
    }
    html:not(.dark) .floating-island a, html:not(.dark) .floating-island button { color: #000000 !important; }

    /* --- SIRI ORB BACKGROUND --- */
    .siri-orb-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 600px; height: 600px; filter: blur(80px); opacity: 0.6; z-index: -1; }
    html.dark .siri-orb-container { opacity: 0.7; }
    .orb { position: absolute; width: 100%; height: 100%; border-radius: 50%; mix-blend-mode: screen; }
    .orb-1 { background: radial-gradient(circle, #ff82c2, transparent 60%); animation: move1 15s infinite alternate; }
    .orb-2 { background: radial-gradient(circle, #8c72ff, transparent 60%); animation: move2 15s infinite alternate; }
    .orb-3 { background: radial-gradient(circle, #60efff, transparent 60%); animation: move3 15s infinite alternate; }
    @keyframes move1 { 0% { transform: translate(0, 0) scale(1); } 50% { transform: translate(150px, 50px) scale(0.8); } 100% { transform: translate(-50px, -100px) scale(1.2); } }
    @keyframes move2 { 0% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-100px, -80px) scale(1.3); } 100% { transform: translate(120px, 100px) scale(0.9); } }
    @keyframes move3 { 0% { transform: translate(0, 0) scale(1); } 50% { transform: translate(50px, 150px) scale(1.1); } 100% { transform: translate(-120px, -50px) scale(0.8); } }

    /* --- CHAT & UI COMPONENTS --- */
    .user-msg { background: #007aff; color: white; border-bottom-right-radius: 0.5rem; }
    .ai-msg { background: #e5e5ea; color: #000000; border-bottom-left-radius: 0.5rem; }
    html.dark .ai-msg { background: #2c2c2e; color: #f5f5f7; }
    .chat-bubble { padding: 0.75rem 1.25rem; border-radius: 1.25rem; max-width: 85%; margin-bottom: 0.5rem; line-height: 1.5; white-space: pre-wrap; }
    .typing-indicator { display: flex; align-items: center; }
    .typing-indicator span { height: 8px; width: 8px; margin: 0 2px; background-color: #8e8e93; display: block; border-radius: 50%; opacity: 0.4; animation: typing 1s infinite; }
    html.dark .typing-indicator span { background-color: #98989e; }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing { 0%, 100% { opacity: 0.4; transform: scale(0.7); } 50% { opacity: 1; transform: scale(1); } }
    
    /* --- CV BUILDER PAGE STYLES --- */
    .cv-preview-name { font-family: 'Playfair Display', serif; }
    .tt-ai-input { padding: 0.75rem; border: 1px solid #ced4da; background-color: #ffffff; border-radius: 0.5rem; width: 100%; color: #212529; transition: all 0.2s ease; }
    html.dark .tt-ai-input { background-color: #2c2c2e; border-color: #424245; color: #f5f5f7; }
    .tt-ai-input:focus { outline: none; border-color: #007aff; box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.25); }
    html.dark .tt-ai-input:focus { border-color: #0a84ff; box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.35); }
    .tt-ai-btn-enhance { margin-top: 0.5rem; background-color: #e7f5ff; color: #007aff; font-weight: 600; padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.3s ease; font-size: 0.875rem; }
    html.dark .tt-ai-btn-enhance { background-color: rgba(10, 132, 255, 0.2); color: #0a84ff; }
    .tt-ai-btn-add { margin-top: 0.5rem; background-color: #e9ecef; color: #495057; font-weight: 600; padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.3s ease; }
    html.dark .tt-ai-btn-add { background-color: #2c2c2e; color: #f5f5f7; }
    .form-section {
      background-color: #ffffff;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }
    html.dark .form-section {
       background-color: #1c1c1e;
       border: 1px solid #2c2c2e;
    }
    .remove-btn { 
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        color: #dc3545; 
        background: none; 
        border: none; 
        cursor: pointer; 
        font-size: 1.5rem;
        line-height: 1;
    }
    html.dark .remove-btn { color: #f87171; }

  </style>
</head>
<body>

  <div id="app-container">
    <div class="siri-orb-container">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <div id="page-1">
        <header id="floatingMenu" class="floating-island fixed top-4 left-1/2 -translate-x-1/2 z-50 rounded-full p-2 flex items-center gap-4 shadow-xl shadow-black/5">
            <a href="#" class="font-semibold text-md dark:text-white pl-3 pr-1 shrink-0">üåê Talent Tag AI</a>
            <nav class="hidden md:flex items-center gap-1 bg-black/5 dark:bg-white/5 p-1 rounded-full">
              <a href="#" class="px-4 py-1.5 text-sm dark:text-gray-300 hover:bg-black/10 dark:hover:bg-white/10 rounded-full transition-colors">About</a>
              <a href="#" class="px-4 py-1.5 text-sm dark:text-gray-300 hover:bg-black/10 dark:hover:bg-white/10 rounded-full transition-colors">Book Mock Interview</a>
            </nav>
            <div class="flex items-center gap-1">
              <button id="themeToggle" aria-label="Toggle color theme" class="text-lg w-10 h-10 flex items-center justify-center rounded-full dark:text-gray-300 hover:bg-black/5 dark:hover:bg-white/5 transition-colors">
                  <i class="fa-solid fa-sun"></i>
              </button>
              <button id="directSignInBtn" class="px-4 py-1.5 text-sm font-semibold bg-black/5 dark:bg-white/5 hover:bg-black/10 dark:hover:bg-white/10 rounded-full transition-colors">
                Sign In
              </button>
            </div>
        </header>

        <main class="min-h-screen flex flex-col justify-center items-center text-center px-4 pt-32 pb-16 relative z-10">
            <h1 class="text-5xl md:text-7xl font-bold mb-6">Your Career, Reimagined.</h1>
            <p class="text-lg md:text-xl mb-8 max-w-2xl">Craft a standout professional CV in minutes. Your career, accelerated by AI.</p>
            <button id="createCvBtn" class="px-8 py-4 mb-16 text-lg font-semibold bg-blue-600 text-white rounded-full hover:bg-blue-700 active:scale-95 transition-all transform shadow-lg">
                Create Your CV with AI
            </button>

            <div class="w-full max-w-3xl bg-white/60 dark:bg-black/50 backdrop-blur-2xl border border-black/10 dark:border-white/10 rounded-2xl shadow-2xl shadow-black/5 p-6 flex flex-col gap-4">
              <p class="font-semibold text-left">Or, ask our AI advisor anything about CVs or interview preparation:</p>
              <div id="chatOutput" class="flex flex-col h-60 overflow-y-auto pr-2"></div>
              <div id="chatInputContainer" class="flex items-center gap-3 border-t border-black/10 dark:border-white/10 pt-4">
                <input id="chatInput" type="text" placeholder="Ask a question..." class="flex-1 px-5 py-3 rounded-full border-0 bg-black/5 dark:bg-white/5 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-black dark:text-white placeholder:text-gray-500 dark:placeholder:text-white/40">
                <button id="sendBtn" title="Send Message" aria-label="Send message" class="p-3 w-12 h-12 flex-shrink-0 rounded-full bg-blue-600 text-white hover:bg-blue-700 active:scale-95 transition-all transform"><i class="fa-solid fa-paper-plane"></i></button>
              </div>
            </div>
        </main>
    </div>

    <!-- Page 2: Choose Username -->
    <div id="page-username" class="hidden"></div>
    
    <!-- Page 3: CV Builder -->
    <div id="page-cv-builder" class="hidden"></div>
  
  <script>
    // --- APP STATE & CONFIG ---
    let auth0Client = null;
    
    const AUTH0_DOMAIN = "dev-bfz0zszo2hm0hh48.us.auth0.com";
    const AUTH0_CLIENT_ID = "9jCHjLnFHK2lWSVfebOlSmntqC5aAZ3h";
    const GEMINI_API_KEY = "AIzaSyDhSlx-QeN6V36XbBR34iqyMz4F42Hx8UY";
    
    // --- MAIN APP LOGIC ---
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            auth0Client = await auth0.createAuth0Client({
                domain: AUTH0_DOMAIN,
                clientId: AUTH0_CLIENT_ID,
                authorizationParams: { redirect_uri: window.location.origin }
            });

            if (location.search.includes("state=") && location.search.includes("code=")) {
                await auth0Client.handleRedirectCallback();
                window.history.replaceState({}, document.title, "/");
            }
        } catch (e) { console.error("Error initializing Auth0 client:", e); }

        const isAuthenticated = await auth0Client.isAuthenticated();
        if(isAuthenticated) {
            showPage('username');
        } else {
            showPage('home');
            initializeHomepage();
        }
    });

    function showPage(pageId) {
        document.getElementById('page-1').classList.add('hidden');
        document.getElementById('page-username').classList.add('hidden');
        document.getElementById('page-cv-builder').classList.add('hidden');

        const targetPage = document.getElementById(`page-${pageId}`);
        if(targetPage) {
            targetPage.classList.remove('hidden');
            if (pageId === 'username' && targetPage.innerHTML.trim() === '') {
                injectUsernamePage(targetPage);
            } else if (pageId === 'cv-builder' && targetPage.innerHTML.trim() === '') {
                injectCvBuilder(targetPage);
            }
        }
    }

    function initializeHomepage() {
        const createCvBtn = document.getElementById("createCvBtn");
        createCvBtn.addEventListener('click', async () => await auth0Client.loginWithRedirect());
        
        const directSignInBtn = document.getElementById("directSignInBtn");
        directSignInBtn.addEventListener('click', async () => await auth0Client.loginWithRedirect());
    }
    
    async function injectUsernamePage(container) {
        container.innerHTML = `
            <main class="min-h-screen flex flex-col justify-center items-center text-center px-4">
                <div class="w-full max-w-md bg-white/60 dark:bg-black/50 backdrop-blur-2xl border border-black/10 dark:border-white/10 rounded-2xl shadow-2xl p-8 space-y-6">
                    <h1 class="text-3xl font-bold">Choose Your Username</h1>
                    <p class="text-gray-600 dark:text-gray-400">This will be your unique URL for your Talent Tag AI profile.</p>
                    <div>
                        <div class="flex items-center border-2 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 dark:border-gray-700">
                            <span class="px-3 text-gray-500">talent-tag.ai/</span>
                            <input id="username-input" type="text" placeholder="your-name" class="flex-1 p-2 bg-transparent focus:outline-none">
                        </div>
                    </div>
                    <div class="flex flex-col items-center gap-4">
                         <p class="font-semibold">Your Profile QR Code:</p>
                         <canvas id="qrcode-canvas"></canvas>
                    </div>
                    <button id="next-to-builder-btn" class="w-full px-6 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-all disabled:bg-gray-400" disabled>Next</button>
                </div>
            </main>
        `;

        const usernameInput = document.getElementById('username-input');
        const nextBtn = document.getElementById('next-to-builder-btn');
        const qrCanvas = document.getElementById('qrcode-canvas');

        const updateProfileUrlAndQr = () => {
            const username = usernameInput.value.toLowerCase().replace(/[^a-z0-9-]/g, '');
            const url = `https://talent-tag.ai/${username}`;
            QRCode.toCanvas(qrCanvas, url, { width: 160 }, (error) => {
                if (error) console.error(error);
            });
            nextBtn.disabled = username.length < 3;
        };
        
        usernameInput.addEventListener('input', updateProfileUrlAndQr);
        nextBtn.addEventListener('click', () => showPage('cv-builder'));
        updateProfileUrlAndQr(); // Initial render
    }

    async function injectCvBuilder(container) {
        // ... (Full injectCvBuilder function remains here, unchanged)
    }
  </script>
</body>
</html>

